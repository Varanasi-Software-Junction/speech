<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Synthetic Speak â€” Interactive Teaching System</title>
  <style>
    :root{ --bg:#f6f8fb; --accent-blue:#0b78d1; --accent-orange:#f97316; --shadow:0 6px 18px rgba(0,0,0,0.08) }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Arial,sans-serif}

    /* Main teaching area */
    .teaching-area{position:fixed;top:16px;left:50%;transform:translateX(-50%);margin:0 auto;padding:18px;width:92%;max-width:920px;background:rgba(255,255,255,0.85);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.12);display:flex;flex-direction:column;align-items:center;gap:14px;z-index:999;border:2px solid var(--accent-blue);transition:all 0.35s ease}

    /* Collapsed state: move to top-right */
    .teaching-area.collapsed{left:auto;right:16px;top:12px;transform:none;width:240px;padding:10px;border-radius:10px;opacity:1}
    /* when collapsed hide large elements */
    .teaching-area.collapsed .slides-container,
    .teaching-area.collapsed .dialogue-box{display:none}
    .teaching-area.collapsed .avatars{justify-content:flex-end}
    .teaching-area.collapsed .avatar-label{display:none}

    /* toggle button */
    .toggle-btn{position:absolute;top:8px;right:10px;padding:6px 10px;background:var(--accent-blue);color:white;border:none;border-radius:6px;font-weight:700;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.18);z-index:1000}

    /* Play button inside teaching area */
    #playBtn{padding:10px 16px;font-size:15px;font-weight:700;background:var(--accent-blue);color:#fff;border:0;border-radius:8px;cursor:pointer;box-shadow:0 6px 18px rgba(11,120,209,0.16)}

    .avatars{width:100%;display:flex;justify-content:space-between;align-items:center}
    .avatar-wrap{display:flex;flex-direction:column;align-items:center;gap:6px;width:140px}
    .avatar{width:110px;height:110px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow);font-weight:800;font-size:44px;color:white}
    .avatar.teacher{background:var(--accent-blue)}
    .avatar.student{background:var(--accent-orange)}
    .avatar.speaking{transform:scale(1.06);box-shadow:0 10px 30px rgba(0,0,0,0.18)}

    .slides-container{display:flex;flex-direction:column;align-items:center;gap:10px;width:100%}
    .slide-column{width:92%;max-width:420px;height:140px;border-radius:10px;background:#fff;border:1px solid #eef6ff;box-shadow:0 6px 18px rgba(2,6,23,0.04);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .slide-text{padding:12px;font-weight:600;color:#0b1220;text-align:center}

    .dialogue-box{font-size:16px;font-weight:500;color:#0b1220;background:white;border-radius:8px;box-shadow:0 6px 18px rgba(2,6,23,0.06);padding:10px 12px;width:92%;max-width:760px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .dialogue-speaker{font-weight:700;color:var(--accent-blue);min-width:90px}

    textarea{display:none}

    @media (max-width:600px){
      .teaching-area{width:96%;padding:12px}
      .avatar{width:84px;height:84px;font-size:32px}
      .avatar-wrap{width:100px}
      #playBtn{padding:8px 12px;font-size:14px}
      .slide-column{height:110px}
    }
  </style>
</head>
<body>
  <div id="teachingarea" class="teaching-area">
    <button id="toggleBtn" class="toggle-btn">Collapse</button>

    <div class="avatars">
      <div class="avatar-wrap">
        <div id="teacherAvatar" class="avatar teacher">T</div>
        <div class="avatar-label">Teacher</div>
      </div>

      <div style="flex:1"></div>

      <div class="avatar-wrap">
        <div id="studentAvatar" class="avatar student">S</div>
        <div class="avatar-label">Student</div>
      </div>
    </div>

    <div class="slides-container">
      <div class="slide-column" id="slideTop"><div class="slide-text" id="slideTopText">(previous slide)</div></div>
      <div class="slide-column" id="slideBottom"><div class="slide-text" id="slideBottomText">(current slide)</div></div>
    </div>

    <div style="display:flex;gap:12px;align-items:center;width:92%;max-width:760px;justify-content:space-between">
      <div class="dialogue-box" style="flex:1"><div id="currentSpeaker" class="dialogue-speaker"></div><div id="currentDialogue">Click Play to start</div></div>
      <button id="playBtn">Play</button>
    </div>

  </div>

  <textarea id="dialoguesText">Teacher: Welcome to today's class.
Student: Hello, I'm ready.
Teacher: We'll discuss data structures.
Student: Sounds great, let's go.
Teacher: First, arrays are contiguous collections.
Student: Okay, I understand the basics now.</textarea>

  <script>
    const toggleBtn = document.getElementById('toggleBtn');
    const teachingArea = document.getElementById('teachingarea');
    const playBtn = document.getElementById('playBtn');
    const teacherAvatar = document.getElementById('teacherAvatar');
    const studentAvatar = document.getElementById('studentAvatar');
    const slideTopText = document.getElementById('slideTopText');
    const slideBottomText = document.getElementById('slideBottomText');
    const currentSpeaker = document.getElementById('currentSpeaker');
    const currentDialogue = document.getElementById('currentDialogue');

    let collapsed = false;
    toggleBtn.addEventListener('click', ()=>{
      collapsed = !collapsed;
      teachingArea.classList.toggle('collapsed', collapsed);
      toggleBtn.textContent = collapsed ? 'Restore' : 'Collapse';
      // when collapsed, make toggle button visible at top-right of area (it's inside area and stays visible)
    });

    // Simple speaking animation using SpeechSynthesis
    function parseDialogues(){
      return document.getElementById('dialoguesText').value.split('\n').map(l=>l.trim()).filter(Boolean).map(l=>{
        const m = l.match(/^(Teacher|Student):\s*(.*)/i);
        if(m) return {role: m[1].toLowerCase(), text: m[2]};
        return {role: 'teacher', text: l};
      });
    }

    function startSpeakingRole(role){
      if(role==='teacher'){
        teacherAvatar.classList.add('speaking');
      } else {
        studentAvatar.classList.add('speaking');
      }
    }
    function stopSpeakingRole(role){
      if(role==='teacher') teacherAvatar.classList.remove('speaking');
      else studentAvatar.classList.remove('speaking');
    }

    function showSlide(line){
      // move bottom to top, new into bottom
      slideTopText.textContent = slideBottomText.textContent;
      slideBottomText.textContent = line.text;
    }

    function speakLine(line){
      return new Promise((res)=>{
        const u = new SpeechSynthesisUtterance(line.text);
        u.rate = 1.0; u.pitch = line.role==='teacher'?1.0:1.05;
        u.onstart = ()=>{ startSpeakingRole(line.role); currentSpeaker.textContent = line.role==='teacher' ? 'Teacher:' : 'Student:'; currentDialogue.textContent = line.text; showSlide(line); };
        u.onend = ()=>{ stopSpeakingRole(line.role); setTimeout(res, 160); };
        speechSynthesis.speak(u);
      });
    }

    async function playAll(){
      // stop any previous
      if(speechSynthesis.speaking) speechSynthesis.cancel();
      const lines = parseDialogues();
      slideTopText.textContent = '(previous slide)';
      slideBottomText.textContent = '(current slide)';
      for(const l of lines){
        await speakLine(l);
      }
      currentSpeaker.textContent = '';
      currentDialogue.textContent = 'All dialogues finished.';
    }

    playBtn.addEventListener('click', ()=>{ playAll(); });

    // make sure toggle doesn't steal focus and hide play when minimized
    const observer = new MutationObserver(()=>{
      if(teachingArea.classList.contains('collapsed')){
        playBtn.style.display = 'none';
      } else {
        playBtn.style.display = '';
      }
    });
    observer.observe(teachingArea, {attributes:true,attributeFilter:['class']});

  </script>
</body>
</html>
